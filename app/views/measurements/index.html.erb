<% content_for :sidenav_switch do @shownavbar = true end %>

<% content_for :sidenav do %>

    <div class="navbar navbar-fixed-left col-xs-12 col-sm-2 col-md-2 bs-sidebar">

      <div class="well">

        <% @currentitem = "measurements" %>

        <%= render 'layouts/devicesmenu' %>

      </div>
    </div>
  
<% end %>

<h1>Measurements <%= link_to 'New', new_measurement_path, :class => "btn btn-success" %></h1>

<% if @measurements.length > 0 then %>

<table class="table table-condensed" >
<thead>

	<th>Device</th>
  <th>Time</th>
  <th>Dataset</th>
  <th>Sample</th>

	<th>Action</th>


</thead>

<tbody>

  <% @measurements.order("created_at DESC").each do |m| %>
    <tr>
      <td>
        <% if m.device.nil? then %>
          Not assigned.
        <% else %>
          <%= link_to m.device.name, m.device %>
        <% end %>
      </td>

      <td>
        <% if !m.recorded_at.nil? then %><%= m.recorded_at.strftime('%Y-%m-%d %H:%M:%S %Z') %><br><% end %>
        <% if !m.recorded_end_at.nil? && !m.recorded_at.nil? then %>Duration: <%= (m.recorded_end_at - m.recorded_at).round(1) %> s<% end %>
      </td>

        <td>
          <% if m.runs.last.nil? then %>

            No Dataset.
          <% else %>
        <% if (m.runs.last.finished && !m.dataset.nil?) then %>

          <b><%= m.dataset.method %></b>&nbsp;-&nbsp;<%= m.dataset.title %>

        <% else %>

          Acquisition Ongoing...

        <% end %>

        <% end %>
      </td>

      <td>

        <% if !m.sample.nil? then %>

        <%= Sample.find(m.sample_id).name %>

        <% else %>

        No sample

        <% end %>
      </td>

      <td>
      	<%= link_to('<span class="glyphicon glyphicon-remove"/>'.html_safe, discard_measurement_path(m), :confirm => "Are you sure you want to discard this measurement?") %>
      </td>

      <td>

      	<% if !m.complete? then %>

  	      <%= link_to edit_measurement_path(m), :class => "btn btn-warning" do %>Import<% end %>

	      <% end %>
  		</td>

      
    </tr>

  <% end %>

</tbody>
</table>


<% else %>
<p>You don't have any Measurements yet.</p>
<% end %> 